@page
@model QuanLyPhongKham.Pages.Profile.IndexModel
@{
    ViewData["Title"] = "Thông tin cá nhân";
}

<h2 class="mb-4 text-primary fw-bold display-6">
    <i class="fas fa-user-circle me-2"></i>Thông tin cá nhân
</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.User != null)
{
    <div class="row align-items-start gx-5">
        <!-- Avatar -->
        <div class="col-md-4 text-center mb-4 mb-md-0">
            @if (!string.IsNullOrEmpty(Model.User.DoctorPath))
            {
                <img src="@Model.User.DoctorPath"
                     alt="Ảnh đại diện"
                     class="rounded-circle border border-3 border-primary shadow-sm"
                     style="width: 180px; height: 180px; object-fit: cover;" />
            }
            else
            {
                <div class="text-muted">
                    <i class="fas fa-user-circle fa-7x mb-2 text-secondary"></i>
                    <p class="fst-italic fs-5">Chưa có ảnh đại diện</p>
                </div>
            }

            <h4 class="mt-3 fw-bold text-primary">@Model.User.FullName</h4>
            <p class="fs-5 text-muted">@Model.User.RoleName</p>
        </div>

        <!-- Thông tin -->
        <div class="col-md-8">
            <ul class="list-unstyled ps-2 fs-5">
                <li class="mb-3"><i class="fas fa-envelope text-primary me-2"></i><strong>Email:</strong> @Model.User.Email</li>
                <li class="mb-3"><i class="fas fa-phone text-primary me-2"></i><strong>Số điện thoại:</strong> @Model.User.Phone</li>
                <li class="mb-3"><i class="fas fa-venus-mars text-primary me-2"></i><strong>Giới tính:</strong> @(Model.User.Gender == "True" ? "Nam" : "Nữ")</li>
                <li class="mb-3"><i class="fas fa-birthday-cake text-primary me-2"></i><strong>Ngày sinh:</strong> @(Model.User.DOB?.ToString("dd/MM/yyyy") ?? "Chưa cập nhật")</li>
                <li class="mb-3"><i class="fas fa-user text-primary me-2"></i><strong>Username:</strong> @Model.User.Username</li>
                <li class="mb-3">
                    <i class="fas fa-check-circle text-primary me-2"></i><strong>Trạng thái:</strong>
                    <span class="badge rounded-pill @(Model.User.Status ? "bg-success" : "bg-danger") fs-6 px-3 py-2">
                        @(Model.User.Status ? "Hoạt động" : "Khoá")
                    </span>
                </li>
            </ul>

            <button class="btn btn-primary btn-lg px-4" data-bs-toggle="modal" data-bs-target="#editModal">
                <i class="fas fa-edit me-2"></i>Chỉnh sửa thông tin
            </button>
            <button class="btn btn-danger ms-2" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                <i class="fas fa-key me-1"></i>Đổi mật khẩu
            </button>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning mt-4 fs-5">
        <i class="fas fa-exclamation-triangle me-2"></i>Không tìm thấy thông tin người dùng.
    </div>
}

<!-- Modal chỉnh sửa thông tin -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <form method="post" asp-page-handler="UpdateProfile">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editModalLabel"><i class="fas fa-user-edit me-2"></i>Chỉnh sửa thông tin cá nhân</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>

                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Họ tên</label>
                            <input name="FullName" class="form-control" value="@Model.Input.FullName" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input name="Email" class="form-control" value="@Model.Input.Email" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Số điện thoại</label>
                            <input name="Phone" class="form-control" value="@Model.Input.Phone" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Ngày sinh</label>
                            <input name="DOB" type="date" class="form-control" value="@(Model.Input.DOB?.ToString("yyyy-MM-dd"))" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Giới tính</label>
                            <select name="Gender" class="form-select">
                                <option value="True" selected="@(Model.Input.Gender == "True")">Nam</option>
                                <option value="False" selected="@(Model.Input.Gender == "False")">Nữ</option>
                            </select>
                        </div>
                    </div>

                    <!-- Hidden fields cần để giữ nguyên giá trị -->
                    <input type="hidden" name="Status" value="@(Model.Input.Status.ToString().ToLower())" />
                    <input type="hidden" name="AccountId" value="@(Model.Input.AccountId)" />
                    <input type="hidden" name="Username" value="@(Model.Input.Username)" />
                    <input type="hidden" name="RoleId" value="@(Model.Input.RoleId)" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal đổi mật khẩu -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content">
            <form method="post" asp-page-handler="ChangePassword">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="changePasswordLabel"><i class="fas fa-key me-2"></i>Đổi mật khẩu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label>Mật khẩu hiện tại</label>
                        <input asp-for="PasswordInput.OldPassword" type="password" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Mật khẩu mới</label>
                        <input asp-for="PasswordInput.NewPassword" type="password" class="form-control" required minlength="6" />
                    </div>
                    <div class="mb-3">
                        <label>Xác nhận mật khẩu mới</label>
                        <input asp-for="PasswordInput.ConfirmPassword" type="password" class="form-control" required />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">Đổi mật khẩu</button>
                </div>
            </form>
        </div>
    </div>
</div>
